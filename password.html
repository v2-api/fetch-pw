<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HTML → Encrypted HTML (AES) — Working Version</title>

  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: #f8fafc;
      color: #0f172a;
      margin: 0;
      padding: 40px;
    }
    textarea, input {
      width: 100%;
      box-sizing: border-box;
      margin-top: 8px;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      padding: 10px;
      font-family: monospace;
      font-size: 13px;
    }
    textarea { height: 300px; }
    button {
      margin-top: 12px;
      padding: 10px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: #0f172a;
      color: white;
      font-weight: 600;
    }
    button.secondary {
      background: #e2e8f0;
      color: #0f172a;
      margin-left: 8px;
    }
    #status {
      margin-top: 10px;
      color: #475569;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <h1>HTML → Encrypted HTML (AES)</h1>
  <p>Paste your full HTML document, choose a password, and click <strong>Encrypt &amp; Download</strong>.</p>

  <label>HTML to Encrypt</label>
  <textarea id="htmlInput"></textarea>

  <label>Password</label>
  <input id="passwordInput" type="password" placeholder="Enter password" />

  <div>
    <button id="encryptBtn">Encrypt &amp; Download</button>
    <button id="sampleBtn" class="secondary">Load Sample</button>
    <button id="clearBtn" class="secondary">Clear</button>
  </div>

  <div id="status"></div>

  <!-- CryptoJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

  <script>
    // Helpers
    function el(id) { return document.getElementById(id); }

    function downloadBlob(blob, filename) {
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    // Build encrypted file HTML
    function buildEncryptedHtml(ciphertext) {
      const page = `<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Encrypted Page</title>
<style>
body {
  font-family: system-ui, sans-serif;
  background: #0f172a;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
}
.card {
  background: white;
  color: #0f172a;
  padding: 20px;
  border-radius: 12px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.2);
}
input,button {
  width: 100%;
  margin-top: 10px;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
  font-size: 14px;
  box-sizing: border-box;
}
button { background:#0f172a; color:white; border:none; cursor:pointer; }
.error { color:#ef4444; margin-top:8px; display:none; }
</style>
</head>
<body>
  <div class="card">
    <h2>Unlock Page</h2>
    <p>Enter password to decrypt the original HTML.</p>
    <input id="pw" type="password" placeholder="Password"/>
    <button id="go">Unlock</button>
    <div id="error" class="error">Wrong password or corrupted data.</div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"><\/script>
  <script>
  (function(){
    const ciphertext = ${JSON.stringify(ciphertext)};
    const pw = document.getElementById("pw");
    const err = document.getElementById("error");

    function decrypt(pass){
      try {
        const bytes = CryptoJS.AES.decrypt(ciphertext, pass);
        const html = bytes.toString(CryptoJS.enc.Utf8);
        return html || null;
      } catch(e){ return null; }
    }

    function unlock(){
      const plain = decrypt(pw.value);
      if(!plain){ err.style.display="block"; return; }
      document.open("text/html", "replace");
      document.write(plain);
      document.close();
    }

    document.getElementById("go").addEventListener("click", unlock);
    pw.addEventListener("keydown", e => { if(e.key==="Enter") unlock(); });
  })();
  <\/script>
</body>
</html>`;
      return page;
    }

    // UI Handlers
    el("sampleBtn").addEventListener("click", () => {
      const sample = `<!doctype html>
<html>
<head><meta charset="utf-8"><title>Sample Page</title></head>
<body style="font-family:sans-serif;padding:30px;">
<h1>Hello — Sample Page</h1>
<p>This is an example HTML that will be encrypted.</p>
</body>
</html>`;
      el("htmlInput").value = sample;
      el("status").textContent = "Sample HTML loaded.";
    });

    el("clearBtn").addEventListener("click", () => {
      el("htmlInput").value = "";
      el("passwordInput").value = "";
      el("status").textContent = "";
    });

    el("encryptBtn").addEventListener("click", () => {
      const html = el("htmlInput").value.trim();
      const pw = el("passwordInput").value;
      if (!html) return el("status").textContent = "Please paste HTML.";
      if (!pw) return el("status").textContent = "Please enter a password.";

      try {
        const ciphertext = CryptoJS.AES.encrypt(html, pw).toString();
        const output = buildEncryptedHtml(ciphertext);
        const blob = new Blob([output], { type: "text/html;charset=utf-8" });
        downloadBlob(blob, "encrypted_page.html");
        el("status").textContent = "✅ Encrypted file downloaded.";
      } catch(e){
        el("status").textContent = "Encryption error: " + e.message;
      }
    });
  </script>
</body>
</html>
